<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App</title>
    <!-- CSS íŒŒì¼ ì—°ë™ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // ì²´í¬ë°•ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            $('.todo-checkbox').on('change', function() {
                var todoId = $(this).data('id');  // ì²´í¬ë°•ìŠ¤ì˜ ë°ì´í„° ID ê°€ì ¸ì˜¤ê¸°
                var completed = $(this).is(':checked');  // ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒëœ ìƒíƒœì¸ì§€ í™•ì¸

                // AJAXë¡œ ì„œë²„ì— ìƒíƒœ ì „ì†¡
                $.ajax({
                    url: '/update_completed/' + todoId,
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ 'completed': completed }),  // JSON í˜•íƒœë¡œ ë°ì´í„° ì „ì†¡
                    success: function(response) {
                        if (response.success) {
                            // ìƒíƒœ ì—…ë°ì´íŠ¸ ì„±ê³µ ì‹œ í˜ì´ì§€ì— ìŠ¤íƒ€ì¼ ë°˜ì˜
                            if (completed) {
                                $(this).closest('li').addClass('completed');  // ì™„ë£Œëœ í•­ëª©ì— í´ë˜ìŠ¤ ì¶”ê°€
                            } else {
                                $(this).closest('li').removeClass('completed');  // ì™„ë£Œë˜ì§€ ì•Šì€ í•­ëª©ì—ì„œ í´ë˜ìŠ¤ ì œê±°
                            }
                        }
                    }.bind(this),  // thisë¥¼ ë°”ì¸ë”©í•˜ì—¬ $(this)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•¨
                    error: function() {
                        alert('Error updating the todo item');
                    }
                });
            });
        });
    </script>
</head>
<body>
    <header>
        <h1>Todo App</h1>
    </header>

    <main>
        <!-- í•  ì¼ ì¶”ê°€ í¼ -->
        <form method="post" action="/add">
            <input type="text" name="title" placeholder="What needs to be done?" required>
            <textarea name="description" placeholder="Add a Description (Optional)" rows="2"></textarea>
            <button type="submit">Add Todo</button>
        </form>
        
        <hr>
        
        <!-- ì°¾ê¸° í¼ (ë¦¬ìŠ¤íŠ¸ ìœ„ë¡œ ì´ë™) -->

        <form method="get" action="/search" class="research-form">
            <input type="text" name="word" placeholder="Search Keyword . . .">
            <button type="submit">Search</button>
        </form>

        <!-- í•  ì¼ ëª©ë¡ -->
        <h2>Your Todo List</h2>
        <ul>
            {% if todos %}
                {% for todo in todos %}
                <li class="{% if todo.completed %}completed{% endif %}">
                    <div class="todo-item">
                        <input type="checkbox" class="todo-checkbox" data-id="{{ todo.id }}" {% if todo.completed %}checked{% endif %}>
                        <div class="todo-details">
                            <span class="todo-text">{{ todo.title }}</span>
                            <span class="todo-description">{{ todo.description }}</span>
                        </div>
                        <div class="todo-actions">
                            <a href="/edit/{{ todo.id }}" class="edit-btn">âœï¸</a>
                            <a href="/delete/{{ todo.id }}" class="delete-btn">ğŸ—‘ï¸</a>
                        </div>
                    </div>
                </li>
                {% endfor %}
            {% else %}
                <p>No todos yet. Add some!</p>
            {% endif %}
        </ul>

        <!-- í˜ì´ì§• ë²„íŠ¼ -->
        <div class="pagination">
            <button>Previous</button>
            <span class="page-number">Page 1 of 1</span>
            <button>Next</button>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 Todo App</p>
    </footer>
</body>
</html>